# üö® –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–∫–∏ "Conflict: terminated by other getUpdates request"

## –©–æ —Ü–µ –æ–∑–Ω–∞—á–∞—î?

–¶—è –ø–æ–º–∏–ª–∫–∞ –≤–∏–Ω–∏–∫–∞—î –∫–æ–ª–∏ **–¥–≤–∞ –∞–±–æ –±—ñ–ª—å—à–µ –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤ –±–æ—Ç–∞** –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ.

Telegram API –¥–æ–∑–≤–æ–ª—è—î **—Ç—ñ–ª—å–∫–∏ –æ–¥–Ω–µ –∞–∫—Ç–∏–≤–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è** –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å (polling).

---

## üîç –ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏:

1. ‚úÖ **–ó–∞–ø—É—â–µ–Ω–æ –¥–µ–∫—ñ–ª—å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤/–ø—Ä–æ—Ü–µ—Å—ñ–≤ –±–æ—Ç–∞** (–Ω–∞–π—á–∞—Å—Ç—ñ—à–µ)
2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π **webhook**, —è–∫–∏–π –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É—î –∑ polling
3. –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø—Ä–æ—Ü–µ—Å **–Ω–µ –∑–∞–≤–µ—Ä—à–∏–≤—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ**
4. –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω–∏–π –Ω–∞ **–∫—ñ–ª—å–∫–æ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö –æ–¥–Ω–æ—á–∞—Å–Ω–æ**

---

## üõ†Ô∏è –†—ñ—à–µ–Ω–Ω—è:

### –ö—Ä–æ–∫ 1: –ó—É–ø–∏–Ω—ñ—Ç—å –í–°–Ü –µ–∫–∑–µ–º–ø–ª—è—Ä–∏ –±–æ—Ç–∞

#### –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ —Ö–æ—Å—Ç–∏–Ω–≥ (Render/Railway/Heroku):
```bash
# –í –ø–∞–Ω–µ–ª—ñ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è:
# 1. –ó–Ω–∞–π–¥—ñ—Ç—å –≤—Å—ñ –∑–∞–ø—É—â–µ–Ω—ñ deployments/services
# 2. –ó—É–ø–∏–Ω—ñ—Ç—å –í–°–Ü
# 3. –ó–∞—á–µ–∫–∞–π—Ç–µ 1-2 —Ö–≤–∏–ª–∏–Ω–∏
# 4. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –¢–Ü–õ–¨–ö–ò –û–î–ò–ù
```

#### –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ Docker:
```bash
# –ó—É–ø–∏–Ω—ñ—Ç—å –≤—Å—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –∑ –±–æ—Ç–æ–º
docker ps -a | grep bot
docker stop <container_id>
docker rm <container_id>

# –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω
docker-compose up -d
```

#### –Ø–∫—â–æ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
# –ó–Ω–∞–π–¥—ñ—Ç—å –ø—Ä–æ—Ü–µ—Å–∏
ps aux | grep "python.*main.py"

# –í–±–∏–π—Ç–µ –≤—Å—ñ –ø—Ä–æ—Ü–µ—Å–∏
pkill -f "python.*main.py"

# –ê–±–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π PID
kill -9 <PID>
```

### –ö—Ä–æ–∫ 2: –í–∏–¥–∞–ª—ñ—Ç—å webhook (—è–∫—â–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π)

```bash
# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ curl –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è webhook
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/deleteWebhook?drop_pending_updates=true"

# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo"
```

–ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:
```bash
chmod +x clear_webhook.sh
./clear_webhook.sh
```

### –ö—Ä–æ–∫ 3: –ó–∞—á–µ–∫–∞–π—Ç–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º

```bash
# ‚è±Ô∏è –í–ê–ñ–õ–ò–í–û: –ó–∞—á–µ–∫–∞–π—Ç–µ 2-3 —Ö–≤–∏–ª–∏–Ω–∏
# Telegram –ø–æ—Ç—Ä–µ–±—É—î —á–∞—Å—É, —â–æ–± –∑–≤—ñ–ª—å–Ω–∏—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è
```

### –ö—Ä–æ–∫ 4: –ó–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞ –û–î–ò–ù –†–ê–ó

```bash
python main.py
```

---

## üîÑ –©–æ —Ä–æ–±–∏—Ç–∏ —è–∫—â–æ –ø–æ–º–∏–ª–∫–∞ –Ω–µ –∑–Ω–∏–∫–ª–∞?

### 1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ webhook —á–µ—Ä–µ–∑ API:
```bash
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo"
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "ok": true,
  "result": {
    "url": "",  // –ü–û–í–ò–ù–ù–û –ë–£–¢–ò –ü–û–†–û–ñ–ù–¨–û!
    "has_custom_certificate": false,
    "pending_update_count": 0
  }
}
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –ë–î —Ç–∞ –±–æ—Ç–∞:
```bash
# –ó—É–ø–∏–Ω—ñ—Ç—å –ë–î (—è–∫—â–æ –ª–æ–∫–∞–ª—å–Ω–æ)
sudo systemctl stop postgresql

# –ó–∞—á–µ–∫–∞–π—Ç–µ 30 —Å–µ–∫—É–Ω–¥

# –ó–∞–ø—É—Å—Ç—ñ—Ç—å –ë–î
sudo systemctl start postgresql

# –ó–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞
python main.py
```

### 3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ webhook –∑–∞–º—ñ—Å—Ç—å polling:

–Ø–∫—â–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç –Ω–µ –≤–∏—Ä—ñ—à—É—î—Ç—å—Å—è, –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ webhook:
```python
# –ó–∞–º—ñ—Å—Ç—å dp.start_polling(bot)
# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ webhook (–ø–æ—Ç—Ä—ñ–±–µ–Ω –ø—É–±–ª—ñ—á–Ω–∏–π HTTPS URL)

from aiohttp import web

async def handle(request):
    update = await request.json()
    await dp.feed_update(bot, Update(**update))
    return web.Response()

app = web.Application()
app.router.add_post('/webhook', handle)

# –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å webhook
await bot.set_webhook(url='https://your-domain.com/webhook')

# –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä
web.run_app(app, port=8080)
```

---

## üìä –õ–æ–≥–∏ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

–ü—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É, –±–æ—Ç –ø–æ–∫–∞–∂–µ:

‚úÖ **–£—Å–ø—ñ—à–Ω–∏–π –∑–∞–ø—É—Å–∫:**
```
INFO: üóëÔ∏è –û—á–∏—â–µ–Ω–Ω—è —á–µ—Ä–≥–∏ —Å—Ç–∞—Ä–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å...
INFO: ‚úÖ Webhook –≤–∏–¥–∞–ª–µ–Ω–æ (—è–∫—â–æ –±—É–≤ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π)
INFO: üîÑ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è...
INFO: ‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω–∏–π! –û—á—ñ–∫—É—é –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å...
INFO: Start polling
```

‚ùå **–ö–æ–Ω—Ñ–ª—ñ–∫—Ç:**
```
ERROR: ‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø—ñ–¥–≥–æ—Ç–æ–≤—Ü—ñ: Conflict...
CRITICAL: üö® –ö–û–ù–§–õ–Ü–ö–¢: –Ü–Ω—à–∏–π –µ–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ –≤–∂–µ –∑–∞–ø—É—â–µ–Ω–∏–π!
CRITICAL:    –ó—É–ø–∏–Ω—ñ—Ç—å –≤—Å—ñ —ñ–Ω—à—ñ –µ–∫–∑–µ–º–ø–ª—è—Ä–∏ —Ç–∞ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É
```

---

## ‚ö° –®–≤–∏–¥–∫–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:

```bash
# 1. –í–∏–¥–∞–ª—ñ—Ç—å webhook
curl "https://api.telegram.org/bot<TOKEN>/deleteWebhook?drop_pending_updates=true"

# 2. –ó–∞—á–µ–∫–∞–π—Ç–µ 2 —Ö–≤–∏–ª–∏–Ω–∏
sleep 120

# 3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞
python main.py
```

---

## üìû –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:

- Telegram API Documentation: https://core.telegram.org/bots/api
- getWebhookInfo: https://core.telegram.org/bots/api#getwebhookinfo
- deleteWebhook: https://core.telegram.org/bots/api#deletewebhook

---

**–†–æ–∑—Ä–æ–±–Ω–∏–∫:** @kilativ100
